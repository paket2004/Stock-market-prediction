import{a as T,b as D,j as e,c as v}from"./@tanstack-CEbkxrhX.js";import{k as j,l as C,j as y,n as F,F as b,$ as E,a0 as P,h as x,a1 as U,a2 as k,a3 as I,a4 as O,z as m,f as N,I as R,a5 as _,a6 as H,a7 as q,a8 as z,i as A,a9 as Z,aa as B,ab as K,ac as Q,ad as V,ae as L,af as G,ag as $,ah as J,ai as W,aj as X,ak as Y,p as w,al as ee,am as se,S as f,D as te,B as ae}from"./index-QORVVTMN.js";import{a as re,S as ne,P as ie}from"./Pagination-DVYfBCCc.js";import{o as oe}from"./url-6_xv0WJS.js";import{r as o}from"./@radix-C9DBgJhe.js";import{C as le}from"./CodeSnippet-BidtnWOi.js";import{u as ce}from"./index.esm-F7nqy9zY.js";import{D as de}from"./DisplayDate-BdguISQF.js";import{I as ue}from"./InlineAvatar-DGf3dVhV.js";import{b as me}from"./@react-router-DYovave8.js";import"./@reactflow-CHBapDaj.js";import"./chevron-right-double-CJ50E9Gr.js";import"./copy-BRhQz3j-.js";function he({params:a}){return["users",a]}async function xe({params:a}){const s=j(C.users.all+"?"+oe(a)),t=await y(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.status===404&&F(),!t.ok)throw new b({message:"Error while fetching users",status:t.status,statusText:t.statusText});return t.json()}function pe(a,s){return T({queryKey:he(a),queryFn:()=>xe(a),...s})}const fe=a=>o.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...a},o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 4C8.06703 4 6.50002 5.567 6.50002 7.5C6.50002 9.433 8.06703 11 10 11C11.933 11 13.5 9.433 13.5 7.5C13.5 5.567 11.933 4 10 4ZM4.50002 7.5C4.50002 4.46243 6.96246 2 10 2C13.0376 2 15.5 4.46243 15.5 7.5C15.5 10.5376 13.0376 13 10 13C6.96246 13 4.50002 10.5376 4.50002 7.5ZM19 14C19.5523 14 20 14.4477 20 15V17H22C22.5523 17 23 17.4477 23 18C23 18.5523 22.5523 19 22 19H20V21C20 21.5523 19.5523 22 19 22C18.4477 22 18 21.5523 18 21V19H16C15.4477 19 15 18.5523 15 18C15 17.4477 15.4477 17 16 17H18V15C18 14.4477 18.4477 14 19 14ZM7.32629 14.5C7.38335 14.5 7.44125 14.5 7.50003 14.5H12C12.5523 14.5 13 14.9477 13 15.5C13 16.0523 12.5523 16.5 12 16.5H7.50003C6.03171 16.5 5.51923 16.5109 5.12917 16.6292C4.17036 16.92 3.42005 17.6703 3.1292 18.6291C3.01088 19.0192 3.00002 19.5317 3.00002 21C3.00002 21.5523 2.55231 22 2.00002 22C1.44774 22 1.00002 21.5523 1.00002 21C1.00002 20.9412 1 20.8833 0.99998 20.8263C0.999526 19.599 0.999216 18.761 1.21532 18.0486C1.70007 16.4506 2.95059 15.2 4.54859 14.7153C5.261 14.4992 6.09902 14.4995 7.32629 14.5Z"}));async function ge(a){const s=j(C.users.all),t=await y(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok){const r=await t.json().then(n=>n.detail).catch(()=>"Failed to create User");throw new b({status:t.status,statusText:t.statusText,message:r})}return t.json()}function je(a){return D({mutationFn:async s=>ge(s),...a})}function Ce(){const[a,s]=o.useState(!1),[t,r]=o.useState(null);return e.jsxs(E,{open:a,onOpenChange:n=>{s(n),r(null)},children:[e.jsx(P,{asChild:!0,children:e.jsx(x,{className:"shrink-0",intent:"primary",children:"Add Member"})}),e.jsxs(U,{className:"",children:[e.jsx(k,{children:e.jsx(I,{children:" Add a New Member"})}),t?e.jsx(be,{name:t.name,token:O(t)}):e.jsx(ye,{setSuccessMember:r})]})]})}m.object({username:m.string(),isAdmin:m.boolean()});function ye({setSuccessMember:a}){const{toast:s}=N(),t=v(),{mutate:r,isPending:n}=je({onError(d){z(d)&&s({status:"error",emphasis:"subtle",icon:e.jsx(A,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:d.message,rounded:!0})},onSuccess(d){a(d),t.invalidateQueries({queryKey:["users"]})}}),l=o.useId(),c=o.useId(),{register:i,handleSubmit:h,watch:p,setValue:u}=ce();function M(d){r({is_admin:d.isAdmin,name:d.username})}return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-user-form",onSubmit:h(M),className:"space-y-5 p-7",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{htmlFor:l,className:"text-text-sm",children:"Username"}),e.jsx(R,{...i("username"),id:l,className:"w-full"})]}),e.jsxs("div",{className:"flex gap-5",children:[e.jsx("label",{htmlFor:c,className:"text-text-md",children:"Add user as an Admin"}),e.jsx(_,{onCheckedChange:d=>u("isAdmin",!!d),...i("isAdmin",{value:!1}),id:c})]})]})}),e.jsxs(H,{className:"gap-[10px]",children:[e.jsx(q,{asChild:!0,children:e.jsx(x,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(x,{disabled:!p("username")||n,form:"create-user-form",size:"sm",children:"Generate Token"})]})]})}function be({token:a,name:s}){return e.jsxs("div",{className:"space-y-5 overflow-hidden p-7 text-center",children:[e.jsx(fe,{className:"m-auto mb-5 h-[110px] w-[110px] fill-success-500"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-lg font-semibold text-theme-text-primary",children:`The user ${s} was created successfully!`}),e.jsx("p",{className:"text-text-md text-theme-text-secondary",children:"Share the invitation link with the user to complete the registration."})]}),e.jsx(le,{className:"mx-auto",code:a})]})}const we=a=>o.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...a},o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.9681 6.38231C3.73647 7.92199 3 9.87499 3 12C3 16.9706 7.02944 21 12 21C14.125 21 16.078 20.2635 17.6177 19.0319L4.9681 6.38231ZM6.38231 4.9681L19.0319 17.6177C20.2635 16.078 21 14.125 21 12C21 7.02944 16.9706 3 12 3C9.87499 3 7.92199 3.73647 6.38231 4.9681ZM1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12Z"})),S=o.forwardRef((a,s)=>{const{triggerChildren:t,children:r,onSelect:n,onOpenChange:l,icon:c,...i}=a;return e.jsxs(Z,{onOpenChange:l,children:[e.jsx(B,{asChild:!0,children:e.jsx(K,{...i,className:"hover:cursor-pointer",icon:a.icon,ref:s,onSelect:h=>{h.preventDefault(),n&&n()},children:t})}),e.jsx(Q,{children:r})]})});S.displayName="AlertDialogItem";async function De(a){const s=j(C.users.detail(a)),t=await y(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok){const r=await t.json().then(n=>n.detail).catch(()=>"Failed to delete User");throw new b({status:t.status,statusText:t.statusText,message:r})}return t.json()}function ve(a){return D({mutationFn:async s=>De(s),...a})}function Ne({userId:a,name:s}){const{toast:t}=N(),r=v(),{isPending:n,mutate:l}=ve({onSuccess(){r.invalidateQueries({queryKey:["users"]})},onError:i=>{i instanceof Error&&t({status:"error",emphasis:"subtle",icon:e.jsx(A,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:i.message,rounded:!0})}});function c(){l(a)}return e.jsxs(V,{className:"p-0",children:[e.jsx(L,{className:"py-2 pl-5 pr-3 text-text-lg font-semibold",children:"Delete Member"}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(G,{children:["Deleting ",e.jsx("strong",{children:s})," cannot be undone."]})}),e.jsxs("div",{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx($,{asChild:!0,children:e.jsx(x,{intent:"secondary",children:"Cancel"})}),e.jsx(J,{asChild:!0,children:e.jsx(x,{onClick:c,disabled:n,intent:"danger",children:"Delete"})})]})]})}function Ae({userId:a,name:s}){const[t,r]=o.useState(!1),[n,l]=o.useState(!1),c=o.useRef(null),i=o.useRef(null);function h(){i.current=c.current}function p(u){if(u===!1){l(!1),setTimeout(()=>{r(u)},200);return}r(u)}return e.jsxs(W,{onOpenChange:l,open:n,children:[e.jsx(X,{ref:c,children:e.jsx(re,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(Y,{hidden:t,onCloseAutoFocus:u=>{i.current&&(i.current.focus(),i.current=null,u.preventDefault())},align:"end",sideOffset:7,children:e.jsx(S,{onSelect:h,onOpenChange:p,triggerChildren:"Remove Member",icon:e.jsx(we,{fill:"red"}),children:e.jsx(Ne,{name:s,userId:a})})})]})}function Se({isAdmin:a}){return[{id:"name",accessorFn:s=>{var t;return{name:s.name,is_admin:!!((t=s.body)!=null&&t.is_admin)}},cell:({getValue:s})=>{const{name:t,is_admin:r}=s();return e.jsxs("div",{className:"flex",children:[e.jsx(ue,{username:t}),r&&e.jsx("div",{children:e.jsx(w,{className:"ml-2 capitalize",size:"xs",color:"purple",children:"Admin"})})]})},header:"User"},{accessorKey:"status",header:"Status",accessorFn:s=>{var t;return{status:(t=s.body)==null?void 0:t.active}},cell:({getValue:s})=>{const{status:t}=s();return e.jsx(w,{className:"capitalize",color:t?"green":"grey",children:t?"Active":"Inactive"})}},{id:"created",header:"Created",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(de,{dateString:s()})})},...a?[{id:"actions",header:"",accessorFn:s=>({id:s.id,name:ee(s)}),meta:{width:"5%"},cell:({getValue:s})=>{const{id:t,name:r}=s();return e.jsx(Ae,{name:r,userId:t})}}]:[]]}const g=1,Me=m.object({page:m.coerce.number().min(g).optional().default(g).catch(g),name:m.string().optional(),operator:m.enum(["and","or"]).optional()});function Te(){const[a]=me(),{page:s,name:t,operator:r}=Me.parse({page:a.get("page")||void 0,name:a.get("name")||void 0,operator:a.get("operator")||void 0});return{page:s,name:t,logical_operator:r}}function Fe(){var c,i;const a=Te(),{data:s,isError:t}=pe({params:{...a,sort_by:"desc:created"}},{throwOnError:!0}),{data:r,isPending:n,isError:l}=se();return t||l?null:n?e.jsx(f,{className:"h-[350px]"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(ne,{searchParams:a}),((c=r.body)==null?void 0:c.is_admin)&&e.jsx(Ce,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(te,{columns:Se({isAdmin:(i=r.body)==null?void 0:i.is_admin}),data:s.items}):e.jsx(f,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(ie,{searchParams:a,paginate:s}):e.jsx(f,{className:"h-[36px] w-[300px]"})]})]})}function Ke(){return e.jsxs(ae,{className:"flex flex-col gap-4 p-5",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Members"}),e.jsx(Fe,{})]})}export{Ke as default};
